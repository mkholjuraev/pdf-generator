import { ServiceCallFunction } from '../call-service';
import ServiceNames from '../service-names';

const vulnerabilityExecutiveReportData = {
  cves_by_severity: {
    '0to3.9': {
      count: 144,
      known_exploit_count: 0,
      percentage: 12.0,
    },
    '4to7.9': {
      count: 904,
      known_exploit_count: 5,
      percentage: 72.0,
    },
    '8to10': {
      count: 201,
      known_exploit_count: 1,
      percentage: 16.0,
    },
    na: {
      count: 0,
      known_exploit_count: 0,
      percentage: 0.0,
    },
  },
  cves_total: 1249,
  meta: {
    permissions: [
      'inventory:*:read',
      'inventory:*:read',
      'inventory:*:read',
      'inventory:*:*',
      'remediations:*:*',
      'inventory:*:read',
      'remediations:remediation:read',
      'remediations:remediation:write',
      'inventory:*:read',
      'inventory:*:read',
      'inventory:*:read',
      'inventory:*:read',
      'inventory:*:read',
      'vulnerability:*:*',
      'inventory:*:read',
      'remediations:*:read',
      'remediations:*:write',
      'inventory:*:read',
      'remediations:remediation:read',
      'remediations:remediation:write',
    ],
  },
  recent_cves: {
    last30days: 1,
    last7days: 0,
    last90days: 45,
  },
  rules_by_severity: {
    '1': {
      rule_count: 0,
      systems_affected: 0,
    },
    '2': {
      rule_count: 0,
      systems_affected: 0,
    },
    '3': {
      rule_count: 19,
      systems_affected: 1814,
    },
    '4': {
      rule_count: 1,
      systems_affected: 2,
    },
  },
  rules_total: 20,
  system_count: 1846,
  top_cves: [
    {
      cvss2_score: 'None',
      cvss3_score: '9.800',
      description:
        'A flaw was found in expat. Passing malformed 2- and 3-byte UTF-8 sequences (for example, from start tag names) to the XML processing application on top of expat can lead to arbitrary code execution. This issue is dependent on how invalid UTF-8 is handled inside the XML processor.',
      known_exploit: true,
      rule_presence: true,
      security_rule: true,
      synopsis: 'CVE-2022-25235',
      systems_affected: 914,
    },
    {
      cvss2_score: 'None',
      cvss3_score: '9.800',
      description:
        'A flaw was found in expat. Passing one or more namespace separator characters in the "xmlns[:prefix]" attribute values made expat send malformed tag names to the XML processor on top of expat. This issue causes arbitrary code execution depending on how unexpected cases are handled inside the XML processor.',
      known_exploit: false,
      rule_presence: false,
      security_rule: false,
      synopsis: 'CVE-2022-25236',
      systems_affected: 914,
    },
    {
      cvss2_score: 'None',
      cvss3_score: '9.800',
      description:
        'An integer overflow was found in expat. The issue occurs in storeRawNames() by abusing the m_buffer expansion logic to allow allocations very close to INT_MAX and out-of-bounds heap writes. This flaw can cause a denial of service or potentially arbitrary code execution.',
      known_exploit: false,
      rule_presence: true,
      security_rule: false,
      synopsis: 'CVE-2022-25315',
      systems_affected: 914,
    },
  ],
  top_rules: [
    {
      associated_cves: ['CVE-2018-10896'],
      description:
        "The default cloud-init configuration is disabling cloud-init's deletion of ssh host keys. In some environments, this could lead to instances created by cloning a golden master or template system, sharing ssh host keys, and being able to impersonate one another or conduct man-in-the-middle attacks.\n",
      name: 'cloud-init: Man In The Middle',
      rule_id: 'CVE_2018_10896_cloud_init|CVE_2018_10896_CLOUD_INIT',
      severity: 4,
      systems_affected: 2,
    },
    {
      associated_cves: ['CVE-2019-1125'],
      description: 'Vulnerable package versions are installed.\n',
      name: '"SWAPGS": CPU side-channel',
      rule_id: 'CVE_2019_1125_kernel|CVE_2019_1125_KERNEL_2',
      severity: 3,
      systems_affected: 802,
    },
    {
      associated_cves: [
        'CVE-2018-12126',
        'CVE-2018-12127',
        'CVE-2018-12130',
        'CVE-2019-11091',
      ],
      description:
        'Installed package versions are unable to assess this vulnerability.\n',
      name: '"MDS": CPU side-channel',
      rule_id:
        'CVE_2018_12130_cpu_kernel|CVE_2018_12130_CPU_KERNEL_NEED_UPDATE',
      severity: 3,
      systems_affected: 801,
    },
  ],
};

const getMock: ServiceCallFunction = () =>
  Promise.resolve(vulnerabilityExecutiveReportData);
const responseProcessor = (data: typeof vulnerabilityExecutiveReportData) =>
  data;

const vulnerabilityDescriptor = {
  responseProcessor,
  path: '/',
  service: ServiceNames.vulnerability,
  mock: getMock,
};

export default vulnerabilityDescriptor;
